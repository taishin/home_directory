autoload -U compinit; compinit

local WHITE=$'%{\e[1;37m%}'
local BLUE=$'%{\e[1;34m%}'
local GREEN=$'%{\e[1;32m%}'
local DEFAULT=$'%{\e[00m%}'

#PROMPT=$BLUE'[${USER}@`hostname`]$ '
PROMPT=$GREEN'[$HOST@`date +%H:%M:%S`] $ '$DEFAULT
RPROMPT=$WHITE'[%~]'$DEFAULT
#RPROMPT='[%~]'

setopt PROMPT_SUBST

# zshè£œå®Œå€™è£œä¸€è¦§ã‚’ã‚«ãƒ©ãƒ¼è¡¨ç¤ºã™ã‚‹
zstyle ':completion:*' list-colors ''

alias gd='dirs -v; echo -n "select number: "; read newdir; cd -"$newdir"'

alias -g L="| less"
alias -g G="| grep"
alias ls="ls -F --color"
alias less="less -R"

typeset -A myabbrev
myabbrev=(
    "ll"    "| less"
    "lg"    "| grep"
    "tx"    "tar -xvzf"
    "tf"    "tail -f"
)

my-expand-abbrev() {
    local left prefix
    left=$(echo -nE "$LBUFFER" | sed -e "s/[_a-zA-Z0-9]*$//")
    prefix=$(echo -nE "$LBUFFER" | sed -e "s/.*[^_a-zA-Z0-9]\([_a-zA-Z0-9]*\)$/\1/")
    LBUFFER=$left${myabbrev[$prefix]:-$prefix}" "
}
zle -N my-expand-abbrev
bindkey     " "         my-expand-abbrev


# based by http://devel.aquahill.net/zsh/zshoptions

# è¤‡æ•°ã® zsh ã‚’åŒæ™‚ã«ä½¿ã†æ™‚ãªã© history ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šæ›¸ãã›ãšè¿½åŠ ã™ã‚‹
setopt append_history

# æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰åãŒãªãã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¨ä¸€è‡´ã—ãŸå ´åˆ cd ã™ã‚‹
setopt auto_cd

# è£œå®Œå€™è£œãŒè¤‡æ•°ã‚ã‚‹æ™‚ã«ã€ä¸€è¦§è¡¨ç¤ºã™ã‚‹
setopt auto_list

# è£œå®Œã‚­ãƒ¼ï¼ˆTab, Ctrl+I) ã‚’é€£æ‰“ã™ã‚‹ã ã‘ã§é †ã«è£œå®Œå€™è£œã‚’è‡ªå‹•ã§è£œå®Œã™ã‚‹
setopt auto_menu

# ã‚«ãƒƒã‚³ã®å¯¾å¿œãªã©ã‚’è‡ªå‹•çš„ã«è£œå®Œã™ã‚‹
setopt auto_param_keys

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã®è£œå®Œã§æœ«å°¾ã® / ã‚’è‡ªå‹•çš„ã«ä»˜åŠ ã—ã€æ¬¡ã®è£œå®Œã«å‚™ãˆã‚‹
setopt auto_param_slash

# æœ€å¾ŒãŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã§çµ‚ã‚ã£ã¦ã„ã‚‹å ´åˆæœ«å°¾ã® / ã‚’è‡ªå‹•çš„ã«å–ã‚Šé™¤ã
#setopt auto_remove_slash

# ã‚µã‚¹ãƒšãƒ³ãƒ‰ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰åã‚’å®Ÿè¡Œã—ãŸå ´åˆã¯ãƒªã‚¸ãƒ¥ãƒ¼ãƒ ã™ã‚‹
setopt auto_resume

# ãƒ“ãƒ¼ãƒ—éŸ³ã‚’é³´ã‚‰ã•ãªã„ã‚ˆã†ã«ã™ã‚‹
setopt NO_beep

# {a-c} ã‚’ a b c ã«å±•é–‹ã™ã‚‹æ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
setopt brace_ccl

# å†…éƒ¨ã‚³ãƒãƒ³ãƒ‰ã® echo ã‚’ BSD äº’æ›ã«ã™ã‚‹
#setopt bsd_echo

# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¯å®Ÿä½“ã‚’è¿½ã†ã‚ˆã†ã«ãªã‚‹
#setopt chase_links

# æ—¢å­˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ãªã„ã‚ˆã†ã«ã™ã‚‹
#setopt clobber

# ã‚³ãƒãƒ³ãƒ‰ã®ã‚¹ãƒšãƒ«ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹
setopt correct

# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å…¨ã¦ã®ã‚¹ãƒšãƒ«ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹
#setopt correct_all

# =command ã‚’ command ã®ãƒ‘ã‚¹åã«å±•é–‹ã™ã‚‹
setopt equals

# ãƒ•ã‚¡ã‚¤ãƒ«åã§ #, ~, ^ ã® 3 æ–‡å­—ã‚’æ­£è¦è¡¨ç¾ã¨ã—ã¦æ‰±ã†
setopt extended_glob

# zsh ã®é–‹å§‹ãƒ»çµ‚äº†æ™‚åˆ»ã‚’ãƒ’ã‚¹ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€
#setopt extended_history

# Ctrl+S/Ctrl+Q ã«ã‚ˆã‚‹ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã‚’ä½¿ã‚ãªã„ã‚ˆã†ã«ã™ã‚‹
setopt NO_flow_control

# å„ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ãã«ãƒ‘ã‚¹ã‚’ãƒãƒƒã‚·ãƒ¥ã«å…¥ã‚Œã‚‹
#setopt hash_cmds

# ç›´å‰ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ãƒ’ã‚¹ãƒˆãƒªã«è¿½åŠ ã—ãªã„
setopt hist_ignore_dups

# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å…ˆé ­ãŒã‚¹ãƒšãƒ¼ã‚¹ã§å§‹ã¾ã‚‹å ´åˆãƒ’ã‚¹ãƒˆãƒªã«è¿½åŠ ã—ãªã„
setopt hist_ignore_space

# ãƒ’ã‚¹ãƒˆãƒªã‚’å‘¼ã³å‡ºã—ã¦ã‹ã‚‰å®Ÿè¡Œã™ã‚‹é–“ã«ä¸€æ—¦ç·¨é›†ã§ãã‚‹çŠ¶æ…‹ã«ãªã‚‹
setopt hist_verify

# ã‚·ã‚§ãƒ«ãŒçµ‚äº†ã—ã¦ã‚‚è£ã‚¸ãƒ§ãƒ–ã« HUP ã‚·ã‚°ãƒŠãƒ«ã‚’é€ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹
setopt NO_hup

# Ctrl+D ã§ã¯çµ‚äº†ã—ãªã„ã‚ˆã†ã«ãªã‚‹ï¼ˆexit, logout ãªã©ã‚’ä½¿ã†ï¼‰
#setopt ignore_eof

# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã‚‚ # ä»¥é™ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨è¦‹ãªã™
setopt interactive_comments

# auto_list ã®è£œå®Œå€™è£œä¸€è¦§ã§ã€ls -F ã®ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®åˆ¥ã‚’ãƒãƒ¼ã‚¯è¡¨ç¤º
setopt list_types

# å†…éƒ¨ã‚³ãƒãƒ³ãƒ‰ jobs ã®å‡ºåŠ›ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ jobs -l ã«ã™ã‚‹
setopt long_list_jobs

# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å¼•æ•°ã§ --prefix=/usr ãªã©ã® = ä»¥é™ã§ã‚‚è£œå®Œã§ãã‚‹
setopt magic_equal_subst

# ãƒ¡ãƒ¼ãƒ«ã‚¹ãƒ—ãƒ¼ãƒ« $MAIL ãŒèª­ã¾ã‚Œã¦ã„ãŸã‚‰ãƒ¯ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡¨ç¤ºã™ã‚‹
#setopt mail_warning

# ãƒ•ã‚¡ã‚¤ãƒ«åã®å±•é–‹ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒãƒƒãƒã—ãŸå ´åˆæœ«å°¾ã« / ã‚’ä»˜åŠ ã™ã‚‹
setopt mark_dirs

# è£œå®Œå€™è£œãŒè¤‡æ•°ã‚ã‚‹æ™‚ã€ä¸€è¦§è¡¨ç¤º (auto_list) ã›ãšã€ã™ãã«æœ€åˆã®å€™è£œã‚’è£œå®Œã™ã‚‹
#setopt menu_complete

# è¤‡æ•°ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚„ãƒ‘ã‚¤ãƒ—ãªã©ã€å¿…è¦ã«å¿œã˜ã¦ tee ã‚„ cat ã®æ©Ÿèƒ½ãŒä½¿ã‚ã‚Œã‚‹
setopt multios

# ãƒ•ã‚¡ã‚¤ãƒ«åã®å±•é–‹ã§ã€è¾æ›¸é †ã§ã¯ãªãæ•°å€¤çš„ã«ã‚½ãƒ¼ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹
setopt numeric_glob_sort

# ã‚³ãƒãƒ³ãƒ‰åã« / ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã¨ã PATH ä¸­ã®ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¢ã™
#setopt path_dirs

# 8 ãƒ“ãƒƒãƒˆç›®ã‚’é€šã™ã‚ˆã†ã«ãªã‚Šã€æ—¥æœ¬èªã®ãƒ•ã‚¡ã‚¤ãƒ«åãªã©ã‚’è¦‹ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹
setopt print_eightbit

# æˆ»ã‚Šå€¤ãŒ 0 ä»¥å¤–ã®å ´åˆçµ‚äº†ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹
#setopt print_exit_value

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¹ã‚¿ãƒƒã‚¯ã«åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ ã—ãªã„ã‚ˆã†ã«ãªã‚‹
#setopt pushd_ignore_dups

# pushd ã‚’å¼•æ•°ãªã—ã§å®Ÿè¡Œã—ãŸå ´åˆ pushd $HOME ã¨è¦‹ãªã•ã‚Œã‚‹
#setopt pushd_to_home

# rm * ãªã©ã®éš›ã€æœ¬å½“ã«å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¶ˆã—ã¦è‰¯ã„ã‹ã®ç¢ºèªã—ãªã„ã‚ˆã†ã«ãªã‚‹
#setopt rm_star_silesetopt prompt_subst

# ã‚·ã‚§ãƒ«ã®ãƒ—ãƒ­ã‚»ã‚¹ã”ã¨ã«å±¥æ­´ã‚’å…±æœ‰
setopt share_history

# history (fc -l) ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ’ã‚¹ãƒˆãƒªãƒªã‚¹ãƒˆã‹ã‚‰å–ã‚Šé™¤ãã€‚
setopt hist_no_store

# æ–‡å­—åˆ—æœ«å°¾ã«æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒç„¡ã„å ´åˆã§ã‚‚è¡¨ç¤ºã™ã‚‹
unsetopt promptcr

#ã‚³ãƒ”ãƒšã®æ™‚rpromptã‚’éè¡¨ç¤ºã™ã‚‹
#setopt transient_rprompt

# cd -[tab] ã§pushd
setopt autopushd

# è£œå®Œå€™è£œè¡¨ç¤ºæ™‚ãªã©ã«ãƒ”ãƒƒãƒ”ã¨ãƒ“ãƒ¼ãƒ—éŸ³ã‚’ãªã‚‰ãªã„ã‚ˆã†ã«è¨­å®š
setopt nolistbeep

### history
setopt histignoredups
#setopt extended_history
HISTFILE=~/.zsh-history
HISTSIZE=100000
SAVEHIST=100000
bindkey '^P' history-beginning-search-backward # å…ˆé ­ãƒãƒƒãƒã®ãƒ’ã‚¹ãƒˆãƒªã‚µãƒ¼ãƒ
bindkey '^N' history-beginning-search-forward # å…ˆé ­ãƒãƒƒãƒã®ãƒ’ã‚¹ãƒˆãƒªã‚µãƒ¼ãƒ


# screenã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ã«ã‚³ãƒãƒ³ãƒ‰ã‚’è¡¨ç¤º
# http://nijino.homelinux.net/diary/200206.shtml#200206140
if [ "$TERM" = "screen" ]; then
	chpwd () { echo -n "_`dirs`\\" }
	preexec() {
		# see [zsh-workers:13180]
		# http://www.zsh.org/mla/workers/2000/msg03993.html
		emulate -L zsh
		local -a cmd; cmd=(${(z)2})
		case $cmd[1] in
			fg)
				if (( $#cmd == 1 )); then
					cmd=(builtin jobs -l %+)
				else
					cmd=(builtin jobs -l $cmd[2])
				fi
				;;
			%*) 
				cmd=(builtin jobs -l $cmd[1])
				;;
			cd)
				if (( $#cmd == 2)); then
					cmd[1]=$cmd[2]
				fi
				;&
			*)
				echo -n "k$cmd[1]:t\\"
				return
				;;
		esac

		local -A jt; jt=(${(kv)jobtexts})

		$cmd >>(read num rest
			cmd=(${(z)${(e):-\$jt$num}})
			echo -n "k$cmd[1]:t\\") 2>/dev/null
	}
	chpwd
fi

PATH=$PATH:$HOME/.rvm/bin # Add RVM to PATH for scripting

if [ x$TERM = xscreen ]; then
  setopt complete_aliases # ã“ã‚Œã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨sshã®è£œå®ŒãŒä½¿ãˆã‚‹
  function ssh-screen() {
    eval SSH_HOST='${'$#'}'
    screen -t ${SSH_HOST} env TERM=screen ssh "$@"
  }
  alias ssh=ssh-screen
fi
